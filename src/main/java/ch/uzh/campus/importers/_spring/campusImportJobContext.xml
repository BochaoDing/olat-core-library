<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	http://www.springframework.org/schema/context 
    http://www.springframework.org/schema/context/spring-context-3.0.xsd 
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd">

	<context:annotation-config />
	<context:component-scan base-package="ch.uzh.campus" />

	<!-- ======================================================================================= -->
	<!-- ==============Quartz Scheduler with the configured triggers================== -->  
	<!-- ======================================================================================= -->
	<bean id="campusSchedulerFactoryBean" class="org.springframework.scheduling.quartz.SchedulerFactoryBean" depends-on="userModule">
	   <property name="triggers">
	  		<list>
				<ref bean="batchlessImportTrigger" />
        	</list>
		</property>
	</bean>

	<!-- ======================================================================================= -->
	<!-- ============== JOB STARTER FOR BATCHLESS IMPORT PROCESS ================== -->
	<!-- ======================================================================================= -->
	<bean id="batchlessImportTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail" ref="batchlessImportProcessJobDetail" />
		<property name="repeatCount" value="0"/>
		<property name="repeatInterval" value="1" />
		<property name="startDelay" value="300" />
	</bean>

	<bean id="batchlessImportProcessJobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
		<property name="targetObject" ref="batchlessImportProcess" />
		<property name="targetMethod" value="process" />
		<property name="concurrent" value="false"/>
		<property name="arguments">
			<list>
				<value>enabled</value>
				<value>BATCHLESS IMPORT PROCESS</value>
			</list>
		</property>
	</bean>

	<bean id="batchlessImportProcess" class="ch.uzh.campus.importers.CampusBatchlessProcess">
		<property name="parameters">
			<map>
				<entry key="dataDir" value="${campus.import.process.sap.resources}" />
				<entry key="exportResource" value="export.csv" />
				<entry key="fileNameSuffix" value="${campus.import.process.sap.files.suffix}" />
				<entry key="fileNamePrefix" value="ZCM_LEHRE===" />
			</map>
		</property>
		<property name="importers" ref="batchlessImporters" />
	</bean>

	<util:map id="batchlessImporters" map-class="java.util.LinkedHashMap">
		<entry key="ZCM_EXP_ORG">
			<bean class="ch.uzh.campus.importers.OrgImporter" />
		</entry>
		<!--<entry key="ZCM_EXP_STUD2">-->
			<!--<bean class="ch.uzh.campus.importers.StudentImporter" />-->
		<!--</entry>-->
		<!--<entry key="ZCM_EXP_DOZ2">-->
			<!--<bean class="ch.uzh.campus.importers.LecturerImporter" />-->
		<!--</entry>-->
		<!--<entry key="ZCM_ED">-->
			<!--<bean class="ch.uzh.campus.importers.CourseImporter">-->
				<!--<property name="semesterMap">-->
					<!--<map>-->
						<!--<entry key="H" value="HS"/>-->
						<!--<entry key="F" value="FS"/>-->
					<!--</map>-->
				<!--</property>-->
			<!--</bean>-->
		<!--</entry>-->
		<!--<entry key="ZCM_EXP_DOZ_E">-->
			<!--<bean class="ch.uzh.campus.importers.LecturerCourseImporter" />-->
		<!--</entry>-->
		<!--<entry key="ZCM_EXP_STUD_E">-->
			<!--<bean class="ch.uzh.campus.importers.StudentCourseImporter" />-->
		<!--</entry>-->
		<!--<entry key="ZCM_EXP_E_TEXT">-->
			<!--<bean class="ch.uzh.campus.importers.TextImporter" />-->
		<!--</entry>-->
		<!--<entry key="ZCM_EXP_E_TERM">-->
			<!--<bean class="ch.uzh.campus.importers.EventImporter" />-->
		<!--</entry>-->
	</util:map>

</beans>
