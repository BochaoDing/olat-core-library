<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
	   http://www.springframework.org/schema/beans/spring-beans.xsd">


	<!-- ======================================================================================= -->
	<!-- ==============Quartz Scheduler with the configured triggers================== -->  
	<!-- ======================================================================================= -->
	<bean id="campusSchedulerFactoryBean" class="org.springframework.scheduling.quartz.SchedulerFactoryBean" depends-on="userModule">
		<property name="triggers">
			<list>
				<ref bean="cronSapImportJobTrigger" />
				<ref bean="cronUserMappingAndSynchronizationJobTrigger" />
			</list>
		</property>
	</bean>
	
	<!-- ======================================================================================= -->
	<!-- ==============JOB STARTER FOR SAP IMPORT================== -->
	<!-- ======================================================================================= -->
	<bean id="cronSapImportJobTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
		<property name="jobDetail" ref="sapImportJobDetail" />
		<property name="cronExpression" value="${campus.import.process.cron.expression}" />
		<property name="startDelay" value="300" />
	</bean>
	
	<bean id="manualSapImportJobTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail" ref="sapImportJobDetail" />
		<property name="repeatCount" value="0"/>
		<property name="repeatInterval" value="1" />
		<property name="startDelay" value="300" />
	</bean>

	<bean id="sapImportJobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
		<property name="targetObject" ref="sapImportJobLauncher" />
		<property name="targetMethod" value="process" />
		<property name="concurrent" value="false"/>
		<property name="arguments">
            <list>
                <value>enabled</value>
                <value>IMPORT PROCESS</value>
            </list>
        </property>
	</bean>
  
	<bean id="sapImportJobLauncher" class="ch.uzh.extension.campuscourse.batchprocessing.CampusBatchJobLauncher">
		<constructor-arg ref="sapImportJob" />
		<constructor-arg ref="jobLauncher" />
		<constructor-arg>
			<map>
				<entry key="orgResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.orgs.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<entry key="courseResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.courses.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<entry key="studentResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.students.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<entry key="lecturerResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.lecturers.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<entry key="studentCourseResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.studentCourses.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<entry key="lecturerCourseResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.lecturerCourses.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<entry key="textResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.texts.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry>
				<!-- DISABLED FOR NOW -->
				<!-- entry key="eventResource">
					<bean class="org.springframework.batch.core.JobParameter">
						<constructor-arg value="${campus.import.process.sap.resources}/${campus.import.process.sap.events.filenameWithoutSuffix}${campus.import.process.sap.files.suffix}" />
					</bean>
				</entry-->
			</map>
		</constructor-arg>
	</bean>

    <!-- ======================================================================================= -->
	<!-- ==============JOB STARTER FOR USER MAPPING AND CAMPUS COURSE SYNCHRONIZATION================= -->
	<!-- ======================================================================================= -->
	<bean id="cronUserMappingAndSynchronizationJobTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
		<property name="jobDetail" ref="userMappingAndSynchronizationJobDetail" />
		<property name="cronExpression" value="${campus.userMapping.process.cron.expression}" />
		<property name="startDelay" value="300" />
	</bean>

	<bean id="manualUserMappingAndSynchronizationJobTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail" ref="userMappingAndSynchronizationJobDetail" />
		<property name="repeatCount" value="0"/>
		<property name="repeatInterval" value="1" />
		<property name="startDelay" value="300" />
	</bean>

	<bean id="userMappingAndSynchronizationJobDetail"
		class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
		<property name="targetObject" ref="userMappingAndSynchronizationJobLauncher" />
		<property name="targetMethod" value="process" />
		<property name="concurrent" value="false"/>
		<property name="arguments">
            <list>
                <value>enabled</value>
				<value>USER MAPPING PROCESS</value>
            </list>
        </property>
	</bean>
   
    <bean id="userMappingAndSynchronizationJobLauncher" class="ch.uzh.extension.campuscourse.batchprocessing.CampusBatchJobLauncher">
		<constructor-arg ref="userMappingAndSynchronizationJob" />
		<constructor-arg ref="jobLauncher" />
		<constructor-arg>
			<map/>
		</constructor-arg>
	</bean>

</beans>
